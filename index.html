<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Scrappy Jump ‚Äî Mini</title>
  <style>
    html, body { margin:0; padding:0; height:100%; }
    body { background:#0f0f12; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; color:#fff; display:flex; align-items:center; justify-content:center; }
    #wrap { width:100%; max-width:420px; aspect-ratio:9/16; position:relative; }
    canvas { width:100%; height:100%; border-radius:18px; background: radial-gradient(120% 120% at 50% 0%, #1c1f2b 0%, #0f0f12 60%, #0b0b0d 100%); display:block; }
    .hud { position:absolute; inset:0; pointer-events:none; display:flex; flex-direction:column; }
    .top { display:flex; justify-content:space-between; padding:12px 14px; font-weight:700; letter-spacing:.5px; text-shadow:0 2px 8px rgba(0,0,0,.6); }
    .center { margin-top:auto; margin-bottom:auto; text-align:center; }
    .btn { pointer-events:auto; display:inline-block; background:#ffffff10; border:1px solid #ffffff25; padding:10px 16px; border-radius:12px; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }
    .title { font-size:24px; font-weight:800; margin-bottom:8px; }
    .hint { opacity:.8; font-size:13px; }
    .badge { font-size:13px; opacity:.8; }
  </style>
</head>
<body>
  <div id="wrap">
    <canvas id="game" width="360" height="640"></canvas>
    <div class="hud">
      <div class="top">
        <div>Score: <span id="score">0</span></div>
        <div class="badge">Best: <span id="best">0</span></div>
      </div>
      <div class="center" id="menu">
        <div class="title">üê© Scrappy Jump</div>
        <div style="margin:10px 0 18px">
          <span class="btn" id="playBtn">Tap to Play</span>
        </div>
        <div class="hint">Tap anywhere to jump. Don‚Äôt hit the boxes.</div>
      </div>
    </div>
  </div>

  <script>
    // --- helpers
    const $ = s => document.querySelector(s);
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

    // --- canvas setup
    const canvas = $('#game');
    const ctx = canvas.getContext('2d');

    // --- game state
    let running = false;
    let tPrev = 0;
    let score = 0;
    let best = parseInt(localStorage.getItem('scrappy_best')||'0',10);

    $('#best').textContent = best;

    // player (Scrappy)
    const player = {
      x: 70, y: 520, w: 36, h: 36,
      vy: 0,
      onGround: false
    };

    // ground line
    const GROUND_Y = 580;

    // obstacles
    const obstacles = [];
    let spawnTimer = 0;
    let speed = 3.2;

    // input
    const input = { pressed: false };
    const press = () => { input.pressed = true; };
    const release = () => { input.pressed = false; };
    canvas.addEventListener('pointerdown', press);
    canvas.addEventListener('pointerup', release);
    canvas.addEventListener('pointercancel', release);
    // allow whole wrapper to start game
    $('#wrap').addEventListener('pointerdown', () => {
      if (!running) startGame();
    });

    // buttons
    $('#playBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      startGame();
    });

    function startGame() {
      running = true;
      $('#menu').style.display = 'none';
      obstacles.length = 0;
      player.y = 520; player.vy = 0; player.onGround = true;
      score = 0;
      speed = 3.2;
      spawnTimer = 0;
      tPrev = performance.now();
      requestAnimationFrame(loop);
    }

    function gameOver() {
      running = false;
      $('#menu').style.display = 'block';
      $('#playBtn').textContent = 'Play Again';
      best = Math.max(best, score);
      localStorage.setItem('scrappy_best', best);
      $('#best').textContent = best;
    }

    function spawnObstacle() {
      // simple box; later you can randomize height/width/sprites
      const size = 36 + Math.random()*14; // 36-50
      obstacles.push({ x: canvas.width + 20, y: GROUND_Y - size, w: size, h: size });
    }

    function update(dt) {
      // spawn
      spawnTimer -= dt;
      if (spawnTimer <= 0) {
        spawnObstacle();
        // spawn faster as score increases
        const base = 900;
        spawnTimer = base - Math.min(650, score*5); // ms
      }

      // movement
      // gravity
      player.vy += 0.0015 * dt * 60; // scale gravity by dt
      player.y += player.vy;

      // ground collision
      if (player.y + player.h >= GROUND_Y) {
        player.y = GROUND_Y - player.h;
        player.vy = 0;
        player.onGround = true;
      } else {
        player.onGround = false;
      }

      // jump
      if (input.pressed && player.onGround) {
        player.vy = -10.8; // jump impulse
        player.onGround = false;
      }

      // obstacles move
      for (const o of obstacles) o.x -= speed * (dt/16.67) * 3.2;

      // remove offscreen + score
      while (obstacles.length && obstacles[0].x + obstacles[0].w < 0) {
        obstacles.shift();
        score++;
        $('#score').textContent = score;
        // increase difficulty every few points
        if (score % 5 === 0) speed = Math.min(7.5, speed + 0.3);
      }

      // collisions (AABB)
      for (const o of obstacles) {
        if (player.x < o.x + o.w &&
            player.x + player.w > o.x &&
            player.y < o.y + o.h &&
            player.y + player.h > o.y) {
          gameOver();
        }
      }
    }

    function draw() {
      // clear
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // ground
      ctx.fillStyle = '#1e212c';
      ctx.fillRect(0, GROUND_Y, canvas.width, canvas.height - GROUND_Y);

      // lane stripes for subtle motion
      ctx.fillStyle = '#252938';
      for (let i=0;i<6;i++){
        const y = GROUND_Y - 10 - i*60;
        ctx.fillRect(0, y, canvas.width, 2);
      }

      // obstacles
      for (const o of obstacles) {
        // box with border
        ctx.fillStyle = '#e9e9ef';
        ctx.fillRect(o.x, o.y, o.w, o.h);
        ctx.strokeStyle = 'rgba(255,255,255,.25)';
        ctx.lineWidth = 2;
        ctx.strokeRect(o.x+0.5, o.y+0.5, o.w-1, o.h-1);
      }

      // player (Scrappy token)
      // base circle
      const r = player.w/2;
      const cx = player.x + r, cy = player.y + r;
      const grad = ctx.createRadialGradient(cx-6, cy-6, 6, cx, cy, r+6);
      grad.addColorStop(0, '#ffffff');
      grad.addColorStop(1, '#c6c7d1');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI*2);
      ctx.fill();
      // tiny ear
      ctx.fillStyle = '#0f0f12';
      ctx.beginPath();
      ctx.arc(cx+6, cy-8, 4, 0, Math.PI*2);
      ctx.fill();
      // shadow
      ctx.globalAlpha = .25;
      ctx.beginPath();
      ctx.ellipse(cx, GROUND_Y+6, r*1.2, r*.5, 0, 0, Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;
    }

    function loop(tNow){
      const dt = clamp(tNow - tPrev, 0, 50); // ms clamp
      tPrev = tNow;
      if (running) {
        update(dt);
        draw();
        requestAnimationFrame(loop);
      } else {
        draw(); // draw final frame under menu
      }
    }

    // initial draw
    draw();
  </script>
</body>
</html>
